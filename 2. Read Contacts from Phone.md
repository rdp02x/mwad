# 2. Read Contacts from Phone

> Develop an application that fetches all contacts phone book and displays on screen.
> 

### Activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
	xmlns:android="<http://schemas.android.com/apk/res/android>"
	xmlns:tools="<http://schemas.android.com/tools>"
	android:orientation="vertical"
	xmlns:app="<http://schemas.android.com/apk/res-auto>"
	android:id="@+id/main"
	android:layout_width="match_parent"
	android:layout_height="match_parent"
	tools:context=".MainActivity">
	<ListView
	  android:id="@+id/contactsListView"
	  android:layout_width="match_parent"
	  android:layout_height="match_parent"/>
  </LinearLayout>

```

### ActivityManifest.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest
	xmlns:android="<http://schemas.android.com/apk/res/android>"
	xmlns:tools="<http://schemas.android.com/tools>">

	<uses-permission android:name="android.permission.READ_CONTACTS" />

	<application
	  android:allowBackup="true"
	  android:dataExtractionRules="@xml/data_extraction_rules"
	  android:fullBackupContent="@xml/backup_rules"
	  android:icon="@mipmap/ic_launcher"
	  android:label="@string/app_name"
	  android:roundIcon="@mipmap/ic_launcher_round"
	  android:supportsRtl="true"
	  android:theme="@style/Theme.Contacts_from_Phone"
	  tools:targetApi="31">

	  <activity
		android:name=".MainActivity"
		android:exported="true">
		<intent-filter>
			<action android:name="android.intent.action.MAIN" />
			<category android:name="android.intent.category.LAUNCHER" />
		</intent-filter>
	  </activity>

	</application>
</manifest>

```

### MainActivity.java

```java
import androidx.core.graphics.Insets;
import androidx.core.view.ViewCompat;
import androidx.core.view.WindowInsetsCompat;
import android.Manifest;
import android.content.pm.PackageManager;
import android.database.Cursor;
import android.os.Bundle;
import android.provider.ContactsContract;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.content.ContextCompat;

import java.util.ArrayList;

public class MainActivity extends AppCompatActivity {
    ListView contactsListView;
    ArrayList < String > contactsList;
    ArrayAdapter < String > adapter;
    final int PERMISSIONS_REQUEST_READ_CONTACTS = 1;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        contactsListView = findViewById(R.id.contactsListView);
        contactsList = new ArrayList < > ();

        // Check permission
        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_CONTACTS) !=
            PackageManager.PERMISSION_GRANTED) {

            ActivityCompat.requestPermissions(this,
                new String[] {
                    Manifest.permission.READ_CONTACTS
                },
                PERMISSIONS_REQUEST_READ_CONTACTS);
        } else {
            loadContacts();
        }
    }
    private void loadContacts() {
        Cursor cursor = getContentResolver().query(
            ContactsContract.CommonDataKinds.Phone.CONTENT_URI,
            null, null, null, null);

        if (cursor != null) {
            while (cursor.moveToNext()) {
                String name = cursor.getString(cursor.getColumnIndexOrThrow(
                    ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME));
                String number = cursor.getString(cursor.getColumnIndexOrThrow(
                    ContactsContract.CommonDataKinds.Phone.NUMBER));

                contactsList.add(name + " : " + number);
            }
            cursor.close();
        }

        adapter = new ArrayAdapter < > (this,
            android.R.layout.simple_list_item_1, contactsList);
        contactsListView.setAdapter(adapter);
    }
    @Override
    public void onRequestPermissionsResult(int requestCode,
        String[] permissions,
        int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);

        if (requestCode == PERMISSIONS_REQUEST_READ_CONTACTS) {
            if (grantResults.length > 0 &&
                grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                loadContacts();
            } else {
                Toast.makeText(this, "Permission denied to read contacts", Toast.LENGTH_SHORT).show();
            }
        }
    }
}

```